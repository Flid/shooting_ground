<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.bundle.min.js"></script>
    <script type="text/javascript" charset="utf-8">
        var socket = io.connect('http://' + document.domain + ':' + location.port);

        socket.on('connect', function() {
            socket.emit('listening_job', {job_id: 3});
        });

        socket.on('new_data', function(new_data){
            console.log(new_data);
            if (percentiles_config['data']['datasets'].length == 0) {

                var dataset_keys = JSON.parse(new_data[0])['response_times_quantiles'][0];
                for (var i=0; i<dataset_keys.length; i++) {
                    percentiles_config['data']['datasets'].push({
                        label: dataset_keys[i] + '%',
                        data: [],
                    })
                }
            }

            for (var i=0; i<new_data.length; i++) {
                new_data_item = JSON.parse(new_data[i]);
                percentiles_config['data']['labels'].push(new_data_item['seconds']);

                for (var j=0; j<new_data_item['response_times_quantiles'][0].length; j++) {
                    percentiles_config['data']['datasets'][j]['data'].push(
                        new_data_item['response_times_quantiles'][1][j]
                    );
                }
            }

            window.percentilesChart.update();
        });
    </script>

        <style>
    canvas{
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
    }
    </style>

</head>

<body>
    <div style="width:75%;">
        <canvas id="canvas"></canvas>
    </div>
    <script>
        var percentiles_config = {
            type: 'line',
            data: {
                labels: [],
                datasets: [],
            },
            options: {
                responsive: true,
                title:{
                    display:true,
                    text:'Percentiles'
                },
                tooltips: {
                    mode: 'index',
                    intersect: false,
                },
                hover: {
                    mode: 'nearest',
                    intersect: true
                },
                scales: {
                    xAxes: [{
                        display: true,
                        scaleLabel: {
                            display: true,
                            labelString: 'Time'
                        }
                    }],
                    yAxes: [{
                        display: true,
                        scaleLabel: {
                            display: true,
                            labelString: 'Response Times'
                        }
                    }]
                }
            }
        };
        window.onload = function() {
            var ctx = document.getElementById("canvas").getContext("2d");
            window.percentilesChart = new Chart(ctx, percentiles_config);
        };

    </script>
</body>

</html>
